Amazon EBS 
====================================
## Summary
- Last Updated : 21.08.28 Sat   
- Updated by : YEONSUN YOON
-----------------------------------

# 스토리지
- 스토리지란 데이터를 저장할 수 있는 공간을 말합니다.
- 스토리지의 주요 형태는 **블록 스토리지**, **파일 스토리지**, **객체 스토리지**가 있습니다.
   
<img width="362" alt="스크린샷 2021-08-26 오후 4 26 59" src="https://user-images.githubusercontent.com/57285121/130919907-f253da14-26fa-4e4a-9829-26617476504c.png">
   
* 블록(Block) 스토리지 : 데이터를 특정 블록(Block)단위로 저장하는 방식.(가장 일반적) 데이터를 찾을 때 각 블록은 블록이 저장된 위치를 가리키는 고유의 주소를 갖고있어 분산 저장된 블록들을 찾아 하나의 데이터로 재구성합니다. 데이터의 잦은 I/O가 발생하고 빠른 성능을 필요로 할 경우에 사용합니다.   
> * Ex) SAN(Storage Area Network)   

* 파일(File) 스토리지 : 디렉토리 구조의 폴더에 파일(File)단위로 데이터를 저장하는 방식. 여러 곳에서 데이터를 공유해야하는 경우 사용합니다.   
> * Ex) NAS(Network Access Storage)   

* 객체(Object) 스토리지 : 가상의 객체에 데이터를 저장하고 API를 통해 데이터에 접근하는 방식. 대용량의 데이터를 저장하고 사용자에게 데이터를 제공해야할 경우 사용합니다. 장소에 구애받지 않고 언제 어디서나 접근이 가능하다는 장점이 있습니다.   
> * Ex) **Amazon S3**   

# AWS 스토리지 서비스
   
<img width="473" alt="스크린샷 2021-08-26 오후 4 44 14" src="https://user-images.githubusercontent.com/57285121/130922345-61619835-788c-49de-91d5-aa8d67e359c4.png">
   
* 인스턴스 스토어
* **Amazon EBS(Block)**
* **Amazon EFS(File)**
* **Amazon S3(Object)**

# 인스턴스 스토어
* 인스턴스 스토어는 **임시적인 블록 스토리지**입니다. 스토리지는 블록 형태로 호스트 컴퓨터에 연결된 디스크입니다.(윈도우의 C드라이브, D드라이브처럼)
* 인스턴스 스토어는 **데이터를 영구적으로 저장하지 않습니다**.(휘발성)
* 인스턴스 스토어는 인스턴스 중지 및 종료할 경우 스토리지가 증발(물론 스토리지 내 데이터들도)하기 때문에 인스턴스 유형을 변경하기 위해 인스턴스 종료 및 중지를 할 수 없습니다.(동적인 인스턴스 구성이 불가능)
* 과거에는 인스턴스 스토어가 EC2 인스턴스 부팅을 위한 정보들이 담겨있는 루트 디바이스였지만 Amazon EBS 출시 이후에는 **루트 디바이스가 Amazon EBS로 변경**되었습니다.

# Amazon EBS
   
<img width="400" alt="스크린샷 2021-08-28 오후 11 48 50" src="https://user-images.githubusercontent.com/57285121/131221914-e6ddfae0-fe98-4279-8de6-e443e4943c51.png">
   
* Amazon EBS(Elastic Block Store)는 AWS에서 사용할 수 있눈 스토리지입니다. 특정 가용 영역(AZ)에서 EBS 볼륨을 생성하고 같은 영역에 위치한 인스턴스와 연결하여 사용 가능합니다.
* Amazon EBS는 **블록 스토리지**형태의 스토리지 서비스입니다.
* Amazon EBS는 **영구적인 스토리지**입니다. 인스턴스의 수명주기와 관계없이 지속되기 때문에 인스턴스 중지 및 종료할 경우에도 삭제되지 않고 필요에 따라 재사용이 가능합니다. 또한 인스턴스에 연결되어 있던 기존의 EBS 볼륨을 분리한 다음 새로운 인스턴스에 연결하여 사용할 수 있습니다.
* Amazon EBS가 제공하는 볼륨의 유형은 **SSD(Solid-State Drive)** , **HDD(Hard Disk Drive)** , 이전세대의 볼륨 유형을 제공합니다.
* Amazon EBS는 **스냅샷** 기능을 지원합니다. 스냅샷을 생성하여 EBS 볼륨의 데이터를 백업할 수 있습니다.
* Amazon EBS는 암호화 기능을 지원합니다. EBS 볼륨 내 데이터들이 민감한 데이터일 경우 암호화 기능을 통해 안전한 데이터 보관이 가능합니다.
* EC2 인스턴스 생성을 위한 AMI 선택 시 루트 디바이스 유형이 대부분 인스턴스 스토어가 아닌 Amazon EBS 로 설정되어 있습니다.
   
<img width="556" alt="스크린샷 2021-08-28 오전 2 30 28" src="https://user-images.githubusercontent.com/57285121/131166455-d5a84aaa-74f7-4b18-a3fb-857d8a45a6ec.png">
   
> * 대부분의 AMI는 루트 디바이스 유형이 `ebs` 입니다. 이러한 이유는 EBS 볼륨이 **인스턴스 중지 후 인스턴스 유형을 수정할 수 있기 때문**입니다. 기존 인스턴스에 대해 변동 사항이 발생하면 인스턴스 유형을 수정해야할 경우가 있는데, 이 때 EBS 볼륨은 인스턴스 중지 후 인스턴스의 유형을 변경 후에 다시 볼륨을 연결하여 사용할 수 있습니다. 하지만 인스턴스 스토어는 인스턴스 생성 시 최초의 인스턴스 유형을 설정하면 변경할 수 없기 때문에 대부분의 루트 디바이스가 `ebs`로 설정되어 있는 것입니다.   
   
|특징|Amazon EBS 지원|인스턴스 스토어 지원|
|------|---|---|
|부팅 시간|빠름(1분 이하)|상대적으로 느림(5분 이하)|
|루트 디바이스 볼륨| **Amazon EBS** |인스턴스 스토어|
|데이터 지속성| **영구적**으로 보관|영구적이지 않고 임시 보관(휘발성)|
|인스턴스 유형 변경| **인스턴스 중지 후 인스턴스 유형 변경 가능** |최초 인스턴스 유형 선택 후 변경 불가|
|인스턴스 중지 및 종료|인스턴스 중지 및 종료 후 **언제든지 재시작 가능** |인스턴스 중지 및 종료 불가|
   
## Amazon EBS 에서 제공하는 볼륨 유형
   
<img width="199" alt="스크린샷 2021-08-28 오전 2 45 55" src="https://user-images.githubusercontent.com/57285121/131168209-e300880a-0fca-4397-b950-7d968c20e225.png">
   
1. SSD(Solid-Statd Drive)
* SSD는 작은 크기의 I/O가 발생할 경우에 적합합니다. 성능 측정 단위는 **IOPS(Input/Output Operation Per Second)** 이며 Gerneral Purpose SSD(gp2, gp3)와 Provisioned IOPS SSD(io1, io2)를 지원합니다.   
> * IOPS란 스토리지에 데이터를 읽고 쓰는 속도를 초(Sec)단위로 계산한 성능 측정 단위입니다.   

1-1. General Purpose SSD(gp2, gp3)
   
![image](https://user-images.githubusercontent.com/57285121/131172036-ead8e6ac-f8d2-4d70-8651-9a9e23145a80.png)
   
* 범용 SSD 입니다. 지연 시간이 짧은 실시간 대화형 애플리케이션이나 테스트 환경에 적합합니다. gp3는 새로 출시된 범용 SSD 으로써 gp2에 비해 비용이 상대적으로 저렴합니다.
* gp2는 볼륨당 최대 250MB/s의 처리량(Throughput)과 1 GB당 3 IOPS의 성능을 보여줍니다. (용량에 따라 IOPS 증가)
* gp3은 볼륨당 최대 1000MB/s의 처리량과 용량에 상관없이 최소 3000 IOPS의 성능을 보여줍니다.→ 낮은 용량의 볼륨을 사용할 경우 gp3를 사용하는 것이 바람직
* **Amazon EBS 다중 연결(여러 인스턴스에 연결)이 불가능**합니다. (1:1로만 연결 가능)

1-2. Provisioned IOPS SSD(io1, io2)
   
![image](https://user-images.githubusercontent.com/57285121/131173243-6c9e007d-a405-434e-a0d3-7c081f31f97d.png)
   
* 프로비저닝된 IOPS SSD 입니다. 범용 SSD 보다 고성능이며 잦은 I/O가 발생하는 작업을 처리하기 적합합니다.   
> * 프로비저닝(Provisioning)이란 자원을 미리 준비해놓고 요청이 들어왔을 때 해당 요청에 알맞게 자원을 공급하는 것을 말합니다. 스토리지 프로비저닝은 사용중이지 않고 낭비되는 스토리지들을 확인하고 풀(Pool)로 옮겨놓은 후 스토리지에 대한 요구 사항이 들어오면 관리자는 풀에서 스토리지를 가져와 인프라 구축에 사용합니다.
   
2. HDD(Hard Disk Drive)
* 대규모의 데이터 처리를 할 경우에 적합합니다. (데이터 규모가 작다면 SSD가 더 적합) 성능 측정 단위는 처리량(Throughput)입니다. Amazon EBS에서는 잦은 액세스가 발생하는 작업을 위한 처리량 최적화 HDD와 비교적 적은 액세스가 발생하는 작업을 위한 Cold HDD를 지원합니다.

2-1. 처리량 최적화 HDD 볼륨(st1)
* 대규모의 데이터에 액세스가 잦은 경우에 적합합니다. 

2-2. Cold HDD(sc1)
* 대규모의 데이터에 액세스가 상대적으로 적은 경우에 적합합니다.

> * Throughput 은 단순히 네트워크 대역폭 측면(Bandwidth)에서의 데이터 전송률을 의미합니다. IOPS는 Throughput 뿐만 아니라 CPU 성능, 측정 OS환경 등의 변수들을 모두 고려한 지표로써 스토리지의 성능을 측정하는 단위로 사용됩니다.

3. 이전 세대(Magnetic)
* 데이터에 액세스하는 빈도가 적은 경우에 적합합니다. 성능이 상대적으로 낮으며 사용을 권장하지 않습니다.

## Amazon EBS Snapshot
* Amazon EBS는 스냅샷 기능을 제공합니다. 특정 시점에 대한 볼륨 스냅샷 기능을 통해 EBS 볼륨의 백업이 가능합니다.
* 생성한 EBS 볼륨의 스냅샷은 계정 간 공유 및 복제, 리전 간 복제가 가능합니다.
   
<img width="723" alt="스크린샷 2021-08-29 오전 12 24 05" src="https://user-images.githubusercontent.com/57285121/131222831-62538d84-8d35-4488-8ef3-d6e73829175b.png">
   
* EBS 볼륨의 스냅샷은 **증분식 백업**으로 저장합니다. 때문에 새 스냅샷을 생성할 때는 마지막 스냅샷 이후 변경된 사항만 저장합니다.
* 증분식 백업의 과정
   
![image](https://user-images.githubusercontent.com/57285121/131222884-2f74dc20-4512-4d5c-87f5-851977f5aa82.png)
   
1. State 1에서 10 GiB의 볼륨 1 을 전체 다 스냅샷 (Snap A)생성 (첫 번째 스냅샷이라서)
2. State 2에서 볼륨 1의 데이터 10 GiB 중 4 GiB의 변동사항 발생
3. Snap B는 10 GiB중 변동사항이 발생한 4 GiB만큼만 생성하고 변동사항이 발생하지 않은 Snap A의 6 GiB를 참조하여 가져옴
4. State 3에서 2 GiB의 데이터가 추가 저장되어 총 12 GiB가 됨
5. Snap C는 추가한 2 GiB만 생성하고 나머지 6 GiB는 Snap A에서, 4 GiB는 Snap B에서 참조
6. 세 스냅샷(Snap A, B, C)을 생성하는데 필요한 총 스토리지는 16 GiB(10 + 4 + 2 GiB)

## Amazon EBS 암호화
   
<img width="388" alt="스크린샷 2021-08-29 오전 12 54 46" src="https://user-images.githubusercontent.com/57285121/131223605-b71d2d04-c868-406c-b48b-dba39822dcd6.png">
   
* Amazon EBS 는 암호화 기능을 제공합니다. 암호화 기능을 통해 EBS 볼륨 내에 저장되어 있는 데이터를 보호할 수 있습니다.
* 암호화된 볼륨 및 스냅샷을 생성할 떄 **AWS KMS Key**를 사용합니다.
* EBS 볼륨 내 데이터, 볼륨과 인스턴스 사이의 데이터 전송 과정에서의 데이터, 볼륨으로부터 생성된 스냅샷 모두 암호화 기능이 적용됩니다.
* Amazon EBS의 암호화 알고리즘은 **AES(대칭키 암호화 방식)** 입니다.

