Amazon EC2
====================================
## Summary
- Last Updated : 21.10.10 Sun   
- Updated by : YEONSUN YOON
-----------------------------------

# Amazon EC2
* Amazon EC2(Elastic Compute Cloud)는 AWS의 가장 대표적인 서비스 중 하나입니다.
* EC2는 클라우드에서 가상의 서버를 구축하기 위한 컴퓨터에 필요한 컴퓨팅 자원을 빌려주는 **컴퓨팅 서비스**입니다.
* EC2 서비스를 통해 생성되는 가상 서버는 **인스턴스**라는 이름으로 생성됩니다.
* 다양한 EC2 리소스들을 조합하여 사용 사례에 맞게 최적화된 인스턴스를 생성하는 것이 중요합니다.

# Amazon EC2 장점
* AWS 웹 관리 콘솔을 통해 클릭 몇 번으로 쉽게 생성과 삭제가 가능합니다. 이를 통해 인스턴스를 구성하는 리소스들의 불필요한 사용을 손 쉽게 줄일 수 있습니다.
* Amazon EC2 서비스는 다양한 **인스턴스 유형**과 **AMI**를 제공합니다. 그 중 목적에 맞는 인스턴스 유형과 AMI를 선택하여 사용할 수 있습니다.

# Amazon EC2 제공 기능
* **인스턴스** : EC2 서비스로 생성되는 가상 서버
* **AMI(Amazon Image Machine)** 
* **인스턴스 유형**
* 인스턴스 스토어 볼륨 / **Amazon EBS(Elastic Block Store)**
* 태그 기능
* 보안 그룹
* 키 페어
* 탄력적 IP 주소(Elastic IP)
* 네트워크 환경 설정(생성한 VPC와 연결)

# 인스턴스 설정 항목

## AMI(Amazon Image Machine)
   
<img width="1300" alt="스크린샷 2021-08-16 오후 9 08 16" src="https://user-images.githubusercontent.com/57285121/129561329-b76aa5a1-6a9e-4bde-931c-d5c58e13ddcb.png">
    
* AMI란 인스턴스의 운영체제와 여러 소프트웨어들이 설치된 '틀'입니다.
* AWS에서 제공하는 AMI를 통해 몇 번의 클릭으로 비슷한 구성의 여러 인스턴스를 찍어내듯이 생성할 수 있습니다.
* AMI를 생성 및 등록한 다음 새 인스턴스를 생성할 때 등록했던 AMI를 그대로 사용할 수 있습니다.
* AWS에서는 리눅스(Amazon Linux, Red Hat Enterprise Linux, Ubuntu, SUSE Linux), 윈도우(Windows)를 제공합니다.
* 이미 만들어져있는 AMI 외에 개인이 직접 제작하여 Marketplace에서 배포도 가능합니다. 이 경우에는 AMI가 안전하지 않을 수도 있기 때문에 배포자를 잘 확인하고 사용하도록 합니다.

### AMI의 가상화 유형
* AMI를 선택하는 화면에서 자세히 보면 대부분의 AMI에서 `가상화 유형 : HVM`이라는 문구를 확인할 수 있습니다.
* AWS에서 제공하는 AMI는 두 가지의 가상화 유형이 존재합니다. 하나는 PV(반가상화), 나머지 하나는 HVM(하드웨어 가상머신)입니다.
* PV와 HVM의 주요 차이점은 '성능 향상을 위한 하드웨어 확장이 가능한가' 입니다. 인스턴스는 요구사항에 따라 변화를 주어야할 경우가 많기 때문에 하드웨어 확장은 필수적입니다. 하지만 PV는 이러한 하드웨어 확장을 활용할 수 없습니다.  이 때문에 대부분의 AMI의 가상화 유형이 HVM으로 설정되어있는 것 입니다.
 
## 인스턴스 유형
   
<img width="1300" alt="스크린샷 2021-08-16 오후 9 33 15" src="https://user-images.githubusercontent.com/57285121/129564378-d7254cc9-fa83-4301-ae4b-6290c35b8c25.png">
   
* 우리가 일반적으로 PC를 구매할 때 PC의 사양을 선택하듯이 AWS에서도 인스턴스의 사양(인스턴스 유형)을 선택할 수 있습니다.
* AWS에서는 다양한 인스턴스 유형(CPU, 메모리, 스토리지, 네트워크 대역폭 등으로 구성된)을 제공합니다. 각각의 사용 사례에 맞는 인스턴스 유형을 선택하여 사용할 수 있습니다.

### 인스턴스 유형 선택 가이드
   
<img width="301" alt="스크린샷 2021-08-16 오후 9 39 24" src="https://user-images.githubusercontent.com/57285121/129565131-d1d32318-148a-47e2-8a13-697e6fb2b35e.png">
   
* 범용적 인스턴스(General) : 가장 범용적인 인스턴스 생성을 위한 인스턴스 유형입니다. 일반적인 인스턴스를 생성하고자 할 때 선택합니다. 종류로는 A1, T2, T3, T3a, T4g, M5, M5a, M5zn, M6g, M6gd 등이 있습니다. 그 중에서 T2, T3, T3a, T4g는 버스트 기능을 지원합니다.   
> * 버스트 기능이란 필요한 만큼 성능을 높일 수 있는 성능 순간 확장 기능입니다. 버스트 기능을 사용하여 기준 사용률을 초과하게 될 경우 추가 요금이 부과됩니다.   

* 컴퓨팅 최적화 인스턴스 : 고성능의 CPU 연산작업을 위한 인스턴스 유형입니다. 종류로는 C5, C5n, C6g, C6gd, C6gn 등이 있습니다.   

* 메모리 최적화 인스턴스 : 메모리 상에서 큰 규모의 데이터를 처리하는 작업을 위한 인스턴스 유형입니다. 종류로는 R5, R5a, R5b, R5n, R6g, R6gd, X1e, X1, X2gd, z1d 등이 있습니다.   
* 스토리지 최적화 인스턴스 : 로컬 스토리지의 대규모 데이터베이스에 대해 잦은 I/O가 발생하는 작업을 위한 인스턴스 유형입니다. 종류로는 D2, D3, D3en, H1, I3, I3en 등이 있습니다.   
* 가속화된 컴퓨팅 최적화 인스턴스 : GPU를 활용한 영상 처리나 그래픽 기능을 활용하기 위한 인스턴스 유형입니다. 종류로는 G4ad, G4dn, G3, G2, P4d, P3, P2 등이 있습니다.

## 네트워크 환경
   
<img width="626" alt="스크린샷 2021-08-17 오전 1 14 19" src="https://user-images.githubusercontent.com/57285121/129595422-20830f8b-e439-469a-a2a8-f1481abd67a5.png">
   
* 인스턴스를 배치할 **네트워크**를 설정합니다.
* 네트워크는 AWS에서 제공하는 **VPC** 서비스를 통해 설정한 범위에서 설정합니다.
* 배치할 VPC 내의 가용영역에 생성된 **서브넷**을 선택합니다.
* 서브넷을 선택하면 서브넷의 사설 IP 대역 내의 IP가 할당됩니다.

## 구매 옵션

* 온디맨드 인스턴스 : 인스턴스를 생성하는 순간부터 초 단위로 비용을 지불하는 방식. 사용한 만큼만 비용을 지불하면 되기 때문에 종료 기간이 불확실한 경우에 사용하기 적합합니다.
* 예약 인스턴스(RI) : 1년 혹은 3년 기간 동안 약정을 맺고 비용을 지불하는 일종의 정액제 요금제. 선 결제시 온디맨드 인스턴스보다 저렴하게 사용할 수 있습니다. 하지만 계약 기간 중 비용 환불이 되지 않기 때문에 인스턴스 사용 기간이 확실한 경우에 사용하기 적합합니다.
* Saving Plans : 예약 인스턴스가 개별 인스턴스에 대한 구매 옵션이라면 Saving Plans는 여러 인스턴스들을 묶은 인스턴스 그룹에 대한 구매 옵션입니다. 마찬가지로 정액제 요금제를 사용하기 때문에 온디맨드 인스턴스보다 비용이 저렴합니다. 여러 인스턴스들을 생성하고자 할 때 해당 요금제를 통해 인스턴스 비용을 최소화 할 수 있습니다.
* 스팟 인스턴스 : 사용중이지 않은 잉여 EC2를 사용하여 상대적으로 적은 비용으로 인스턴스를 생성할 수 있습니다. 하지만 인스턴스가 갑작스럽게 종료가 될 수 있기 때문에 대비책을 마련해야 합니다.

## 스토리지
   
<img width="1161" alt="스크린샷 2021-08-17 오전 1 31 24" src="https://user-images.githubusercontent.com/57285121/129597751-4920dfab-42c6-49ef-a194-e57af4635f2c.png">
   
* 인스턴스의 스토리지를 설정합니다.
* 인스턴스를 생성할 때마다 생성한 인스턴스에 대한 루트 스토리지 디바이스가 생성됩니다.
* 루트 스토리지 디바이스에는 인스턴스 부팅을 위해 필요한 정보들이 포함되어 있습니다. 
제공되는 스토리지 옵션 : 인스턴스 스토어, Amazon EBS,  EC2 + Amazon EFS, EC2 + Amazon S3
* 사용 가능한 디바이스의 이름(루트 포함)은 가상화 유형과 AMI에 따라 조금씩 차이가 있습니다. 가상화 유형이 HVM인 AMI에서 가질 수 있는 루트 디바이스의 이름은 /dev/xvda(Amazon Linux 2) 혹은 /dev/sda1(RHEL, Ubuntu, SUSE Linux, Windows)이 있고 EBS 볼륨으로 생성할 디바이스 이름은 /dev/sd[f~p]이 적절합니다.

## 태그
   
<img width="1163" alt="스크린샷 2021-08-17 오전 1 39 09" src="https://user-images.githubusercontent.com/57285121/129598748-14048318-a4b6-4917-92b2-37bffafb5c78.png">
   
* 인스턴스를 구별하기 위한 식별자로 태그를 사용할 수 있습니다.

## 보안그룹
   
<img width="1158" alt="스크린샷 2021-08-17 오전 1 34 16" src="https://user-images.githubusercontent.com/57285121/129598113-a431f2d2-7a8a-449e-b3a9-baa35f79b49e.png">
   
* 인스턴스에 대한 트래픽을 제어하는 **방화벽**입니다. 
* 인바운드 트래픽의 프로토콜, 포트, source IP 범위를 지정할 수 있습니다.

# 인스턴스 수명 주기
   
<img width="544" alt="스크린샷 2021-08-17 오전 1 55 09" src="https://user-images.githubusercontent.com/57285121/129600700-8489a965-d112-4563-9b3b-0364ff013f0e.png">
   
* EC2 인스턴스는 시작 ~ 종료 사이에 다양한 상태로 전환됩니다.

## 인스턴스 시작
* 인스턴스를 시작하면 `running`상태 이전에 먼저 `pending`상태로 전환됩니다.
* `pending` 상태에서는 비용이 청구되지 않으며 선택한 인스턴스 유형과 AMI에 따라 인스턴스를 생성할 준비를 합니다.
* AMI의 부팅정보를 참조하여 부팅을 위한 준비를 마치면 `running`상태로 전환됩니다.
* 인스턴스가 `running` 상태가 되면 비용이 청구됩니다.

## 인스턴스 중지
* 인스턴스가 `running`상태일 때 중지를 하게되면 `stopping`상태를 거친 후 `stopped`상태가 됩니다.
* 인스턴스에 연결되어 있던 EBS 볼륨은 그대로 유지됩니다. EBS 볼륨을 연결하거나 분리할 수 있으며 나중에 언제든 다시 시작할 수 있습니다.
* 인스턴스가 `stopped`상태일 경우에는 비용이 청구되지 않지만 EBS 볼륨에 대한 스토리지 비용은 청구됩니다. 또한 인스턴스에 대해 변경사항(인스턴스 유형 등)을 반영할 수 있습니다.

## 인스턴스 종료
* 인스턴스를 종료하면 `shutting-down`상태를 거쳐 `terminated`상태가 됩니다.
* `shutting-down`, `terminated` 두 상태 모두 비용이 청구되지 않습니다.
* 루트 디바이스 볼륨은 삭제되며 그 이외에 EBS 볼륨은 삭제되지 않고 유지됩니다.
